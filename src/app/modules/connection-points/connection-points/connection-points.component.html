<!--suppress HtmlFormInputWithoutLabel, HtmlUnknownAttribute -->
<main class="main">
  <div class="wrapper">
    <h1>Сводные данные по организациям</h1>

    <form [formGroup]="form">
      <div class="filter">
        <div class="filter-header" [class.filter-header-active]="isVisibleFilter">
          <div class="filter-title" (click)="showFilterBody()">
            <span><i class="fas fa-filter"></i>Фильтр</span>
            <span>
              <i nz-icon nzType="search" style="font-size: 1.5rem; color: #35a5f9"></i>
              <i nz-icon nzType="caret-down" nzTheme="outline" style="font-size: 1.5rem; color: #35a5f9"></i>
            </span>
          </div>
          <div class="filter-export">
            <button
              (click)="serviceLocation.exportExcel()"
              type="button"
              class="filter-export-button"
            >Выгрузить в Excel
            </button>
          </div>
        </div>
        <div class="filter-body" [class.filter-body-active]="isVisibleFilter">
          <div class="filter-container">
            <nz-form-item>
              <nz-form-label>Населенный пункт</nz-form-label>
              <nz-form-control>
                <nz-select
                  nzShowSearch
                  nzAllowClear
                  nzPlaceHolder=""
                  formControlName="location"
                  [nzSuffixIcon]="suffixIconSelect"
                >
                  <nz-option
                    *ngFor="let item of fLocations$ | async"
                    [nzLabel]="item.fullName + '(' + item.parent.fullName + ')'"
                    [nzValue]="item"
                  >
                  </nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label>Наим. организации</nz-form-label>
              <nz-form-control>
                <input nz-input formControlName="organization" type="text"/>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label>Тип подключения</nz-form-label>
              <nz-form-control>
                <app-simple-select
                  [items]="fInternetAccessTypes$ | async"
                  [form]="form"
                  [iFormControl]="'connectionType'"
                ></app-simple-select>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item class="rowspan2">
              <nz-form-label>Район</nz-form-label>
              <nz-form-control>
                <!--                <app-simple-select-->
                <!--                  [items]="fParents$ | async"-->
                <!--                  [form]="form"-->
                <!--                  [iFormControl]="'parent'"-->
                <!--                ></app-simple-select>-->
                <div [formGroup]="form">
                  <nz-select
                    formControlName="parent"
                    nzShowSearch
                    nzAllowClear
                    [nzMaxTagCount]="10"
                    [nzMaxTagPlaceholder]="tagPlaceHolder"
                    nzPlaceHolder=""
                    [nzSuffixIcon]="suffixIconSelect"
                    nzMode="multiple"
                  >
                    <nz-option
                      *ngFor="let item of fParents$ | async"
                      [nzLabel]="item.name"
                      [nzValue]="item.id"
                    >
                    </nz-option>
                  </nz-select>
                  <ng-template #tagPlaceHolder let-selectedList>
                    и еще {{ selectedList.length }}
                  </ng-template>
                </div>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label>Тип организации</nz-form-label>
              <nz-form-control>
                <app-simple-select
                  [items]="fOrganizationTypes$ | async"
                  [form]="form"
                  [iFormControl]="'type'"
                ></app-simple-select>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label>Оператор связи</nz-form-label>
              <nz-form-control>
                <input nz-input formControlName="contractor" type="text"/>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label>Тип СЗО</nz-form-label>
              <nz-form-control>
                <app-simple-select
                  [items]="fOrganizationSMOTypes$ | async"
                  [form]="form"
                  [iFormControl]="'smo'"
                ></app-simple-select>
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
        <div class="filter-footer" [class.filter-footer-active]="isVisibleFilter">
          <div class="filter-sort">
            <app-filter-btn
              formControlName="order"
              [orderings]="[
                      {name: 'Нас.пункт', value: 'name', orderingDirection: OrderingDirection.UNDEFINED },
                      {name: 'Район', value: 'parent__name', orderingDirection: OrderingDirection.UNDEFINED },
                      {name: 'Численность', value: 'people_count', orderingDirection: OrderingDirection.UNDEFINED }
                  ]"
            >
            </app-filter-btn>
          </div>
          <div class="filter-result">
            Результатов поиска: <span>{{ (organization$ | async)?.count }}</span>
          </div>
          <div class="filter-search">
            <nz-input-group [nzSuffix]="suffixIconSearch">
              <input type="text" nz-input placeholder=""/>
            </nz-input-group>
            <ng-template #suffixIconSearch>
              <i nz-icon nzType="search" style="color: #35a5f9"></i>
            </ng-template>
          </div>
        </div>
      </div>
      <ng-template #suffixIconSelect>
        <i nz-icon nzType="caret-down" nzTheme="outline" style="color: #35a5f9"></i>
      </ng-template>
    </form>

    <div class="container-header">
      <div>Населенный пункт</div>
      <div>Организация</div>
      <div>Адрес</div>
    </div>
    <div class="container-list">
      <ng-container
        *ngFor="
          let organization of (organization$ | async)?.results
            | paginate
              : {
                  itemsPerPage: itemsPerPage,
                  currentPage: pageNumber,
                  totalItems: (organization$ | async)?.count
                }
        "
      >
        <ng-container *ngIf="true; else emptyOrganization">
          <div

            class="container-wrap"
          >
            <div class="container-wrap1">
              <div>
                <div>{{ organization?.location.fullName }}</div>
                <div>{{ organization?.location?.parent?.fullName }}</div>
                <div>{{ organization?.location.population }} чел.</div>
              </div>
              <div>
                <a [routerLink]="[organization.id]" class="link">Подробнее</a>
              </div>
            </div>
            <div class="container-wrap2">
              <div class="">
                <div>{{ organization?.name }}</div>
              </div>
              <hr>
              <div class="container-wrap4">
                <div>
                  <span class="">Тип организации:</span>
                  {{ organization.type ? organization.type.name : ' ' }}
                </div>
                <div>
                  <span class="">Тип СЗО:</span>
                  {{ organization.smoType ? organization.smoType.name : ' ' }}
                </div>
              </div>
            </div>
            <div class="container-wrap3">
              <ng-container *ngFor="let point of organization.reaccesspoints">
                <div class="container-point">
                  <div class="container-info">
                    <div class="container-info-icon">
                      <ng-container *ngIf="point.governmentProgram?.shortName === 'ЕСПД'; else smoIcon">
                        <img src="/assets/8.png"/>
                      </ng-container>
                      <ng-template #smoIcon>
                        <img src="/assets/7.png"/>
                      </ng-template>
                    </div>
                    <span>{{ point.address ? point.address : '----' }}</span>
                  </div>
                  <div class="container-info">
                    <div class="container-info-icon">
                      <img src="/assets/2.png"/>
                    </div>
                    <span>{{ point.contractor ? point.contractor : '----' }}</span>
                  </div>
                  <div class="container-info">
                    <div class="container-info-icon">
                      <img src="/assets/4.png"/>
                    </div>
                    <span>{{ point.connectionType ? point.connectionType : '----' }}</span>
                  </div>
                  <div class="container-info">
                    <div class="container-info-icon">
                      <img src="/assets/5.png"/>
                    </div>
                    <span>{{ point.declaredSpeed ? point.declaredSpeed : '----' }}</span>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>
        </ng-container>
        <ng-template #emptyOrganization>
          <div class="container-wrap">
            <div class="container-wrap1">
              <div>
                <div>{{ organization?.location.fullName }}</div>
                <div>{{ organization?.location?.parent?.fullName }}</div>
                <div>{{ organization?.location.population }} чел.</div>
              </div>
            </div>
            <div class="container-wrap2"></div>
            <div class="container-wrap3"></div>
          </div>
        </ng-template>
      </ng-container>
    </div>

    <!--<div class="c-filter">
      <accordion class="c-accordion">
        <group>
          <accordion-header class="c-accordion-title">
            <div class="c-filter-icon">Фильтры</div>
          </accordion-header>
          <div>
            <form [formGroup]="form">
              <div class="l-container">
                <div class="l-container-item js-filter-button">
                  <app-filter-btn
                    formControlName="order"
                    [orderings]="[
                      {
                        name: 'Нас.пункт',
                        value: 'name',
                        orderingDirection: OrderingDirection.UNDEFINED
                      },
                      {
                        name: 'Район',
                        value: 'parent__name',
                        orderingDirection: OrderingDirection.UNDEFINED
                      }
                    ]"
                  >
                  </app-filter-btn>
                </div>
                <div class="l-container-item">
                  <div class="l-container-row is-disabled">
                    <div class="input">
                      <div class="o-item-title">Населенный пункт:</div>
                      <nz-select
                        nzShowSearch
                        nzAllowClear
                        nzPlaceHolder=""
                        [(ngModel)]="setLocation"
                        formControlName="location"
                      >
                        <nz-option
                          *ngFor="let item of fLocations$ | async"
                          [nzLabel]="item.fullName + '(' + item.parent.fullName + ')'"
                          [nzValue]="item"
                        >
                        </nz-option>
                      </nz-select>
                      &lt;!&ndash;<select formControlName="location">
                        <option [ngValue]="null">Не выбран</option>
                        <option [ngValue]="item" *ngFor="let item of fLocations$ | async">{{
                          item.fullName
                          }} ({{item.parent.fullName}})</option>
                      </select>&ndash;&gt;
                    </div>
                  </div>
                  <div class="l-container-row is-disabled">
                    <div class="input">
                      <div class="o-item-title">Тип учреждения:</div>
                      <app-simple-select
                        [items]="fOrganizationTypes$ | async"
                        [form]="form"
                        [iFormControl]="'type'"
                      ></app-simple-select>
                      &lt;!&ndash;<select formControlName="type">
                        <option [ngValue]="null">Не выбран</option>
                        <option [ngValue]="item" *ngFor="let item of fOrganizationTypes$ | async">{{
                          item.name
                          }}</option>
                      </select>&ndash;&gt;
                    </div>
                  </div>
                  <div class="l-container-row is-disabled">
                    <div class="input">
                      <div class="o-item-title">Тип СЗО:</div>
                      <app-simple-select
                        [items]="fOrganizationSMOTypes$ | async"
                        [form]="form"
                        [iFormControl]="'smo'"
                      ></app-simple-select>
                      &lt;!&ndash;<select formControlName="smo">
                        <option [ngValue]="null">Не выбран</option>
                        <option
                          [ngValue]="item"
                          *ngFor="let item of fOrganizationSMOTypes$ | async"
                        >{{ item.name }}</option
                        >
                      </select>&ndash;&gt;
                    </div>
                  </div>
                  <div class="l-container-row is-disabled">
                    <div class="input">
                      <div class="o-item-title">Наим. организации:</div>
                      <input nz-input formControlName="organization" type="text" />
                    </div>
                  </div>
                </div>
                <div class="l-container-item">
                  <div class="l-container-row is-disabled">
                    <div class="input">
                      <div class="o-item-title">Район:</div>
                      <app-simple-select
                        [items]="fParents$ | async"
                        [form]="form"
                        [iFormControl]="'parent'"
                      ></app-simple-select>
                      &lt;!&ndash;<select formControlName="parent">
                        <option [ngValue]="null">Не выбран</option>
                        <option [ngValue]="item" *ngFor="let item of fParents$ | async">{{
                          item.fullName
                          }}</option>
                      </select>&ndash;&gt;
                    </div>
                  </div>
                  <div class="l-container-row is-disabled">
                    <div class="input">
                      <div class="o-item-title">Подключение:</div>
                      <app-simple-select
                        [items]="fInternetAccessTypes$ | async"
                        [form]="form"
                        [iFormControl]="'connectionType'"
                      ></app-simple-select>
                      &lt;!&ndash;<select formControlName="connectionType">
                        <option [ngValue]="null">Не выбран</option>
                        <option
                          [ngValue]="item"
                          *ngFor="let item of fInternetAccessTypes$ | async"
                        >{{ item.name }}</option
                        >
                      </select>&ndash;&gt;
                    </div>
                  </div>
                  <div class="l-container-row is-disabled">
                    <div class="input">
                      <div class="o-item-title">Контракт:</div>
                      <app-simple-select
                        [items]="fGovernmentPrograms$ | async"
                        [form]="form"
                        [iFormControl]="'contractType'"
                      ></app-simple-select>
                      &lt;!&ndash;<select formControlName="contractType">
                        <option [ngValue]="null">Не выбран</option>
                        <option
                          [ngValue]="item"
                          *ngFor="let item of fGovernmentPrograms$ | async"
                        >{{ item.shortName }}</option
                        >
                      </select>&ndash;&gt;
                    </div>
                  </div>
                  <div class="l-container-row is-disabled">
                    <div class="input">
                      <div class="o-item-title">Оператор связи:</div>
                      <input nz-input formControlName="contractor" type="text" />
                    </div>
                  </div>
                </div>
              </div>
              <input (click)="form.reset()" class="btn filter-btn-reset" value="Сбросить фильтр" />
            </form>
          </div>
        </group>
      </accordion>
      <div class="c-filter-info">
        <div class="c-filter-result">
          Результатов поиска: <span>{{ (locations$ | async)?.count }}</span>
        </div>
        <div class="c-filter-export">
          <input
            (click)="serviceLocation.exportExcel()"
            type="button"
            class="btn"
            value="Выгрузить в Excel"
          />
        </div>
      </div>
    </div>
    <div class="layout-list">
      <div class="layout-list-group"
           *ngFor="
          let location of (locations$ | async)?.results
            | paginate
              : {
                  itemsPerPage: itemsPerPage,
                  currentPage: pageNumber,
                  totalItems: (locations$ | async)?.count
                }
        "
      >
        <ng-container *ngIf="location.organizations.length !== 0; else emptyOrganization">
          <div class="layout-list-item"
               *ngFor="let organization of location.organizations; let i = index"
          >
            <div class="c-location-name">
              <div class="c-location-name-item1">{{ location.fullName }}</div>
              <div class="c-location-name-item2">{{ location.municipalityArea }}</div>
            </div>
            <div class="layout-col">
              <div class="layout-col-item1">
                <div>{{ organization.fullName }}</div>
                <div>
                  <span class="u-gray">Тип организации: </span>
                  {{ organization.type ? organization.type.name : ' ' }}
                </div>
                <div>
                  <span class="u-gray">Тип СЗО:</span>
                  {{ organization.smoType ? organization.smoType.name : ' ' }}
                </div>
                <a [routerLink]="[organization.id]" class="btn">Подробнее</a>
              </div>
              <div class="layout-col-item2">
                <div
                  class="layout-point"
                  *ngFor="let point of organization.reaccesspoints"
                >
                  <div class="layout-point-address">
                    <div
                      *ngIf="point.governmentProgram?.shortName === 'ЕСПД'; else smoIcon"
                    >
                      <img
                        class="c-contract-info__img"
                        src="../../../../assets/img/espd.svg"
                        alt="ЕСПД"
                      />
                    </div>
                    <ng-template #smoIcon>
                      <img
                        class="c-contract-info__img"
                        src="../../../../assets/img/smo.svg"
                        alt="ЕСПД"
                      />
                    </ng-template>
                    <span>{{ point.address ? point.address : '&#45;&#45;&#45;&#45;' }}</span>
                  </div>
                  <div class="layout-point-info">
                    <div class="flex-row">
                      <i class="fas fa-bullhorn"></i>
                      <span>{{ point.contractor ? point.contractor : '&#45;&#45;&#45;&#45;' }}</span>
                    </div>
                    <div class="flex-row">
                      <i class="fas fa-plug"></i>
                      <span>{{ point.connectionType ? point.connectionType.name : '&#45;&#45;&#45;&#45;' }}</span>
                    </div>
                    <div class="flex-row">
                      <i class="fas fa-tachometer-alt"></i>
                      <span>{{ point.definedSpeed }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
        <ng-template #emptyOrganization>
          <div class="layout-list-item">
            <div class="c-location-name">
              <div class="c-location-name-item1">{{ location.fullName }}</div>
              <div class="c-location-name-item2">{{ location.municipalityArea }}</div>
            </div>
            <div class="layout-col">
              <div class="layout-col-item1"></div>
              <div class="layout-col-item2"></div>
            </div>
          </div>
        </ng-template>

      </div>
    </div>-->

    <div style="display: flex; justify-content: flex-end">
      <div class="pagination-count">
        <div style="margin-right: 13px">Количество строк на странице:</div>
        <input
          class="pagination-count-button"
          [class.active]="itemsPerPage === 10"
          type="button"
          (click)="itemsPerPage = 10; organization$ = loadPagedLocationWithOrganizationAccessPoints()"
          value="10"
        />
        <input
          class="pagination-count-button"
          [class.active]="itemsPerPage === 20"
          type="button"
          (click)="itemsPerPage = 20; organization$ = loadPagedLocationWithOrganizationAccessPoints()"
          value="20"
        />
        <input
          class="pagination-count-button"
          [class.active]="itemsPerPage === 100"
          type="button"
          (click)="itemsPerPage = 100; organization$ = loadPagedLocationWithOrganizationAccessPoints()"
          value="100"
        />
      </div>
    </div>
    <pagination-controls
      class="pagination-controls"
      nextLabel="Следующая страница"
      previousLabel="Предыдущая страница"
      (pageChange)="onPageChange($event)"
    >
    </pagination-controls>
  </div>
</main>

<ngx-spinner
  bdOpacity="0.9"
  size="medium"
  color="#35a584"
  type="ball-atom"
  class="spinner"
  [fullScreen]="true"
>Загрузка. . .
</ngx-spinner>
