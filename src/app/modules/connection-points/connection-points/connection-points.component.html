<!--suppress HtmlFormInputWithoutLabel -->
<main class="main">
  <div class="wrapper">
    <h1>Сводные данные по организациям</h1>
    <div class="c-filter">
      <div class="c-accordion">
        <div class="c-accordion-title">
          <div class="c-filter-icon">Фильтры</div>
          <div class="c-accordion-button"></div>
        </div>
        <div class="c-accordion-body" style="display: block;">
          <form [formGroup]="form">
            <div class="l-container">
              <div class="l-container-item js-filter-button">
                <app-filter-btn
                  formControlName="order"
                  [orderings]="[
                    {
                      name: 'Нас.пункт',
                      value: 'name',
                      orderingDirection: OrderingDirection.UNDEFINED
                    },
                    {name: 'Район', value: 'parent', orderingDirection: OrderingDirection.UNDEFINED}
                  ]"
                >
                </app-filter-btn>
              </div>
              <div class="l-container-item">
                <div class="l-container-row is-disabled">
                  <div class="input">
                    <div class="o-item-title">Населенный пункт:</div>
                    <select formControlName="location">
                      <option [ngValue]="null">Не выбран</option>
                      <option [ngValue]="item" *ngFor="let item of fLocations$ | async">{{
                        item.fullName
                      }}</option>
                    </select>
                  </div>
                </div>
                <div class="l-container-row is-disabled">
                  <div class="input">
                    <div class="o-item-title">Тип учреждения:</div>
                    <select formControlName="type">
                      <option [ngValue]="null">Не выбран</option>
                      <option [ngValue]="item" *ngFor="let item of fOrganizationTypes$ | async">{{
                        item.name
                      }}</option>
                    </select>
                  </div>
                </div>
                <div class="l-container-row is-disabled">
                  <div class="input">
                    <div class="o-item-title">Тип СЗО:</div>
                    <select formControlName="smo">
                      <option [ngValue]="null">Не выбран</option>
                      <option
                        [ngValue]="item"
                        *ngFor="let item of fOrganizationSMOTypes$ | async"
                        >{{ item.name }}</option
                      >
                    </select>
                  </div>
                </div>
                <div class="l-container-row is-disabled">
                  <div class="input">
                    <div class="o-item-title">Наим. организации:</div>
                    <input formControlName="organization" type="text" />
                  </div>
                </div>
              </div>
              <div class="l-container-item">
                <div class="l-container-row is-disabled">
                  <div class="input">
                    <div class="o-item-title">Район:</div>
                    <select formControlName="parent">
                      <option [ngValue]="null">Не выбран</option>
                      <option [ngValue]="item" *ngFor="let item of fParents$ | async">{{
                        item.fullName
                      }}</option>
                    </select>
                  </div>
                </div>
                <div class="l-container-row is-disabled">
                  <div class="input">
                    <div class="o-item-title">Подключение:</div>
                    <select formControlName="connectionType">
                      <option [ngValue]="null">Не выбран</option>
                      <option [ngValue]="item" *ngFor="let item of fInternetAccessTypes$ | async">{{
                        item.name
                      }}</option>
                    </select>
                  </div>
                </div>
                <div class="l-container-row is-disabled">
                  <div class="input">
                    <div class="o-item-title">Контракт:</div>
                    <select formControlName="contractType">
                      <option [ngValue]="null">Не выбран</option>
                      <option [ngValue]="item" *ngFor="let item of fGovermentPrograms$ | async">{{
                        item.shortName
                      }}</option>
                    </select>
                  </div>
                </div>
                <div class="l-container-row is-disabled">
                  <div class="input">
                    <div class="o-item-title">Оператор связи:</div>
                    <input formControlName="contractor" type="text" />
                  </div>
                </div>
              </div>
            </div>
            <input (click)="form.reset()" class="btn filter-btn-reset" value="Сбросить фильтр" />
          </form>
        </div>
      </div>
      <div class="c-filter-info">
        <div class="c-filter-result">
          <!-- Результатов поиска: <span>{{locations.count}}</span> -->
        </div>
        <div class="c-filter-export">
          <input type="button" class="btn" value="Выгрузить в Excel" />
        </div>
      </div>
    </div>
    <div class="c-contract" *ngIf="locations$ | async as locations">
      <div
        class="c-contract-item"
        *ngFor="
          let location of locations.results
            | paginate
              : {
                  itemsPerPage: itemsPerPage,
                  currentPage: pageNumber,
                  totalItems: locations.count
                }
        "
      >
        <accordion>
          <group>
            <accordion-header>
              <div class="c-contract-header" style="width: 100%">
                <div class="c-location-name">
                  <div class="c-location-name-item1">{{ location.fullName }}</div>
                  <div class="c-location-name-item2">{{ location.municipalityArea }}</div>
                </div>
                <div class="location-count">
                  Количество: <span>{{ location.organizations.length }}</span>
                </div>
              </div>
            </accordion-header>
            <accordion
              class="c-accordion"
              *ngFor="let organization of location.organizations; let i = index"
            >
              <group>
                <accordion-header class="c-accordion-title">
                  <div class="c-accordion-number">{{ i + 1 }}</div>
                  <div class="c-accordion-name">
                    <div>{{ organization.fullName }}</div>
                    <div class="c-accordion-info">
                      <div class="c-accordion-info-item">
                        <span class="u-gray">учреждение:</span>
                        {{ organization.type ? organization.type.name : ' ' }}
                      </div>
                      <div class="c-accordion-info-item">
                        <span class="u-gray">сзо:</span>
                        {{ organization.smoType ? organization.smoType.name : ' ' }}
                      </div>
                    </div>
                  </div>
                </accordion-header>
                <div class="l-contract" *ngFor="let point of organization.reaccesspoints">
                  <div class="c-contract-info u-span3">
                    <i class="far fa-map-marker-alt"></i
                    ><span>{{ point.address ? point.address : '----' }}</span>
                  </div>
                  <div class="с-contract-info-container">
                    <div class="c-contract-info" *ngIf="point.governmentProgram">
                      <img
                        class="c-contract-info__img"
                        *ngIf="point.governmentProgram.shortName === 'ЕСПД'"
                        src="../../../../assets/img/espd.svg"
                        alt="ЕСПД"
                      />
                      <img
                        class="c-contract-info__img"
                        *ngIf="point.governmentProgram.shortName === 'СЗО'"
                        src="../../../../assets/img/smo.svg"
                        alt="СЗО"
                      />
                    </div>
                    <div class="c-contract-info">
                      <i class="fas fa-bullhorn"></i
                      ><span>{{ point.contractor ? point.contractor : '----' }}</span>
                    </div>
                    <div class="c-contract-info">
                      <i class="fas fa-plug"></i
                      ><span>{{ point.connectionType ? point.connectionType.name : '----' }}</span>
                    </div>
                    <div class="c-contract-info">
                      <i class="fas fa-tachometer-alt"></i><span>{{ point.definedSpeed }}</span>
                    </div>
                  </div>
                </div>
              </group>
            </accordion>
          </group>
        </accordion>
      </div>
    </div>
  </div>
  <div style="display: flex; justify-content: flex-end">
    <div class="pagination-count">
      <div style="margin-right: 13px">Количество строк на странице:</div>
      <input
        class="pagination-count-button"
        [class.active]="itemsPerPage === 10"
        type="button"
        (click)="itemsPerPage = 10; locations$ = loadPagedLocationWithContracts()"
        value="10"
      />
      <input
        class="pagination-count-button"
        [class.active]="itemsPerPage === 20"
        type="button"
        (click)="itemsPerPage = 20; locations$ = loadPagedLocationWithContracts()"
        value="20"
      />
      <input
        class="pagination-count-button"
        [class.active]="itemsPerPage === 100"
        type="button"
        (click)="itemsPerPage = 100; locations$ = loadPagedLocationWithContracts()"
        value="100"
      />
    </div>
  </div>
  <pagination-controls
    class="pagination-controls"
    nextLabel="Следующая страница"
    previousLabel="Предыдущая страница"
    (pageChange)="onPageChange($event)"
  >
  </pagination-controls>
</main>

<ngx-spinner
  bdOpacity="0.9"
  size="medium"
  color="#35a584"
  type="ball-atom"
  class="spinner"
  [fullScreen]="true"
  >Загрузка. . .
</ngx-spinner>
