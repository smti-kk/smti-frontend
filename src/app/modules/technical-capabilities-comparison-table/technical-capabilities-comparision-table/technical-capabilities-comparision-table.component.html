<!--suppress HtmlFormInputWithoutLabel -->
<main class="main">
  <div class="wrapper">
    <div class="page-header" style="align-items: center">
      <h1>Сводная таблица - Сравнение технических возмоностей</h1>
      <div style="width: 215px;height: 23px;">
        <nz-select
          [formControl]="featuresTypeSelector"
          [nzSuffixIcon]="suffixIconSelect"
          style="width: 100%"
        >
          <nz-option nzLabel="Интернет" nzValue="internet"></nz-option>
          <nz-option nzLabel="Сотовая связь" nzValue="mobile"></nz-option>
        </nz-select>
      </div>
    </div>
    <!--<div class="c-filter" *ngIf="featuresTypeSelector.value">
      <accordion class="c-accordion">
        <group>
          <accordion-header class="c-accordion-title">
            <div class="c-filter-icon">Фильтры</div>
          </accordion-header>
          <div>
            <form [formGroup]="filterForm">
              <div class="l-container">
                <div class="l-container-item js-filter-button">
                  <app-filter-btn
                    formControlName="order"
                    [orderings]="[
                      {
                        name: 'Нас.пункт',
                        value: 'name',
                        orderingDirection: OrderingDirection.UNDEFINED
                      },
                      {
                        name: 'Район',
                        value: 'parent__name',
                        orderingDirection: OrderingDirection.UNDEFINED
                      },
                      {
                        name: 'Численность',
                        value: 'people_count',
                        orderingDirection: OrderingDirection.UNDEFINED
                      }
                    ]"
                  >
                  </app-filter-btn>
                </div>
                <div class="l-container-item">
                  <div class="l-container-row is-disabled">
                    <div class="input">
                      &lt;!&ndash;                      <app-grouped-autocomplete-component&ndash;&gt;
                      &lt;!&ndash;                        placeholder="Населенный пункт"&ndash;&gt;
                      &lt;!&ndash;                        [optionGroups]="locations"&ndash;&gt;
                      &lt;!&ndash;                        *ngIf="fLocations$ | async as locations"&ndash;&gt;
                      &lt;!&ndash;                      >&ndash;&gt;
                      &lt;!&ndash;                      </app-grouped-autocomplete-component>&ndash;&gt;
                      <div class="o-item-title">Населенный пункт:</div>
                      <nz-select
                        nzShowSearch
                        nzAllowClear
                        nzPlaceHolder=""
                        formControlName="location"
                      >
                        <nz-option
                          *ngFor="let item of fLocations$ | async"
                          [nzLabel]="item.fullName + '(' + item.parent.fullName + ')'"
                          [nzValue]="item"
                        >
                        </nz-option>
                      </nz-select>
                      &lt;!&ndash;<select formControlName="location">
                        <option [ngValue]="null">Не выбран</option>
                        <option [ngValue]="item" *ngFor="let item of fLocations$ | async">
                          {{ item.fullName }} ({{ item.parent.fullName }})</option
                        >
                      </select>&ndash;&gt;
                    </div>
                  </div>
                  <div class="l-container-row is-disabled">
                    <div class="input">
                      <div class="o-item-title">Район:</div>
                      <app-simple-select
                        [items]="fParents$ | async"
                        [form]="filterForm"
                        [iFormControl]="'parent'"
                      ></app-simple-select>
                      &lt;!&ndash;<select formControlName="parent">
                        <option [ngValue]="null">Не выбран</option>
                        <option [ngValue]="item" *ngFor="let item of fParents$ | async">{{
                          item.fullName
                        }}</option>
                      </select>&ndash;&gt;
                    </div>
                  </div>
                  <div
                    class="l-container-row is-disabled"
                    *ngIf="featuresTypeSelector.value === featureTypes.MOBILE"
                  >
                    <div class="input">
                      <div class="o-item-title">
                        <i class="fas fa-mobile-alt"></i> Сотовая связь:
                      </div>
                      <div class="vendors-container">
                        <div class="vendors-container u-border-right">
                          <div
                            formGroupName="mobile"
                            class="c-vendor"
                            *ngFor="let mobileProvider of mobileProviders; let i = index"
                          >
                            <label [formGroupName]="i.toString()">
                              <input
                                [formControlName]="mobileProvider.id.toString()"
                                type="checkbox"
                              />
                              <div class="c-vendor-logo c-vendor-checked">
                                <img
                                  [src]="mobileProvider.icon"
                                  [alt]="mobileProvider.name"
                                  [title]="mobileProvider.name"
                                />
                              </div>
                            </label>
                          </div>
                        </div>
                      </div>
                      <div class="c-radiobox l-radiobox-row">
                        <label>
                          <input
                            formControlName="mobileType"
                            [value]="MobileGeneration._2G"
                            type="radio"
                          />
                          <div class="c-radiobox-text">2G</div>
                        </label>
                        <label>
                          <input
                            formControlName="mobileType"
                            [value]="MobileGeneration._3G"
                            type="radio"
                          />
                          <div class="c-radiobox-text">3G</div>
                        </label>
                        <label>
                          <input
                            formControlName="mobileType"
                            [value]="MobileGeneration._4G"
                            type="radio"
                          />
                          <div class="c-radiobox-text">4G</div>
                        </label>
                        <label>
                          <input
                            formControlName="mobileType"
                            [value]="MobileGeneration._5G"
                            type="radio"
                          />
                          <div class="c-radiobox-text">5G</div>
                        </label>
                      </div>
                    </div>
                  </div>
                  <div
                    class="l-container-row is-disabled"
                    *ngIf="featuresTypeSelector.value === featureTypes.INTERNET"
                  >
                    <div class="input">
                      <div class="o-item-title">
                        <i class="fab fa-internet-explorer"></i> Интернет:
                      </div>
                      <div class="vendors-container u-border-right">
                        <div
                          formGroupName="internet"
                          class="c-vendor"
                          *ngFor="let internetProvider of internetProviders; let i = index"
                        >
                          <label [formGroupName]="i.toString()">
                            <input
                              type="checkbox"
                              [formControlName]="internetProvider.id.toString()"
                            />
                            <div class="c-vendor-logo c-vendor-checked">
                              <img
                                [src]="internetProvider.icon"
                                [alt]="internetProvider.name"
                                [title]="internetProvider.name"
                              />
                            </div>
                          </label>
                        </div>
                      </div>
                      <div class="c-radiobox l-radiobox-column">
                        <label
                        ><input
                          formControlName="internetType"
                          type="radio"
                          [value]="TrunkChannel.SATELLITE"
                        />
                          <div class="c-radiobox-text">Спутник</div>
                        </label>
                        <label
                        ><input
                          formControlName="internetType"
                          type="radio"
                          [value]="TrunkChannel.VOLS"
                        />
                          <div class="c-radiobox-text">ВОЛС</div>
                        </label>
                        <label
                        ><input
                          formControlName="internetType"
                          type="radio"
                          [value]="TrunkChannel.COPPER_CABLE"
                        />
                          <div class="c-radiobox-text">Медь</div>
                        </label>
                        <label
                        ><input
                          formControlName="internetType"
                          type="radio"
                          [value]="TrunkChannel.RADIO_CHANEL"
                        />
                          <div class="c-radiobox-text">Радиоканал</div>
                        </label>
                      </div>
                    </div>
                  </div>
                  <div class="l-container-row is-disabled">
                    <div class="input">
                      <div class="o-item-title">Программа:</div>
                      <app-simple-select
                        [items]="fGovernmentPrograms$ | async"
                        [form]="filterForm"
                        [iFormControl]="'govProgram'"
                      ></app-simple-select>
                    </div>
                  </div>
                </div>
              </div>
              <input type="reset" class="btn filter-btn-reset" value="Сбросить фильтр"/>
            </form>
          </div>
        </group>
      </accordion>
      <div class="c-filter-info">
        <div class="c-filter-result" *ngIf="featuresTypeSelector.value">
          Результатов: <span>{{ (this.features$ | async)?.count }}</span>
        </div>
        <div class="c-filter-export">
          <input (click)="exportXLSX()" type="button" class="btn" value="Выгрузить в Excel"/>
        </div>
      </div>
    </div>-->

    <form [formGroup]="filterForm">
      <div class="filter">
        <div class="filter-header" [class.filter-header-active]="isVisibleFilter">
          <div class="filter-title" (click)="showFilterBody()">
            <span><i class="fas fa-filter"></i>Фильтр</span>
            <span style="font-size: 1.5rem; color: #ff5700">
              <i nz-icon nzType="search"></i>
              <i nz-icon nzType="caret-down" nzTheme="outline"></i>
            </span>
          </div>
          <div class="filter-export">
            <button
              (click)="serviceLocation.exportExcel()"
              type="button"
              class="filter-export-button"
            >Выгрузить в Excel
            </button>
          </div>
        </div>
        <div class="filter-body" [class.filter-body-active]="isVisibleFilter">
          <div class="filter-container">
            <nz-form-item>
              <nz-form-label>Населенный пункт</nz-form-label>
              <nz-form-control>
                <nz-select
                  nzShowSearch
                  nzAllowClear
                  nzPlaceHolder=""
                  formControlName="location"
                  [nzSuffixIcon]="suffixIconSelect"
                >
                  <nz-option
                    *ngFor="let item of fLocations$ | async"
                    [nzLabel]="item.fullName + '(' + item.parent + ')'"
                    [nzValue]="item"
                  >
                  </nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label>Сотовая связь</nz-form-label>
              <nz-form-control>
                <ng-container
                  *ngFor="let mobileProvider of mobileProviders; let i = index"
                >
                  <label
                    nz-checkbox
                    [formControlName]="mobileProvider.id.toString()"
                  >
                    {{mobileProvider.name}}
                  </label>
                </ng-container>
                <!--                <div class="vendors-container">-->
                <!-- <div
                   formGroupName="mobile"
                   class="c-vendor"
                   *ngFor="let mobileProvider of mobileProviders; let i = index"
                 >
                   <label [formGroupName]="i.toString()">
                     <input
                       [formControlName]="mobileProvider.id.toString()"
                       type="checkbox"
                     />
                     <div class="c-vendor-logo c-vendor-checked">
                       <img
                         [src]="mobileProvider.icon"
                         [alt]="mobileProvider.name"
                         [title]="mobileProvider.name"
                       />
                     </div>
                   </label>
                 </div>-->
                <!--                </div>-->
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label>Тип подключения</nz-form-label>
              <nz-form-control>
                <label nz-checkbox formControlName="mobileType">2G</label>
                <label nz-checkbox formControlName="mobileType">3G</label>
                <label nz-checkbox formControlName="mobileType">4G</label>
                <label nz-checkbox formControlName="mobileType">5G</label>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label>Интернет</nz-form-label>
              <nz-form-control>
                <ng-container
                  *ngFor="let internetProvider of internetProviders; let i = index"
                >
                  <label
                    nz-checkbox
                    [formControlName]="internetProvider.id.toString()"
                  >
                    {{internetProvider.name}}
                  </label>
                </ng-container>
                <!--<div class="vendors-container">
                  <div
                    formGroupName="internet"
                    class="c-vendor"
                    *ngFor="let internetProvider of internetProviders; let i = index"
                  >
                    <label [formGroupName]="i.toString()">
                      <input
                        type="checkbox"
                        [formControlName]="internetProvider.id.toString()"
                      />
                      <div class="c-vendor-logo c-vendor-checked">
                        <img
                          [src]="internetProvider.icon"
                          [alt]="internetProvider.name"
                          [title]="internetProvider.name"
                        />
                      </div>
                    </label>
                  </div>
                </div>-->
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label>Тип подключения</nz-form-label>
              <nz-form-control>
                <label nz-checkbox formControlName="internetType">ВОЛС</label>
                <label nz-checkbox formControlName="internetType">Медь</label>
                <label nz-checkbox formControlName="internetType">Спутник</label>
                <label nz-checkbox formControlName="internetType">Радио</label>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item class="rowspan2">
              <nz-form-label>Район</nz-form-label>
              <nz-form-control>
                <nz-select
                  formControlName="parent"
                  nzShowSearch
                  nzAllowClear
                  [nzMaxTagCount]="10"
                  [nzMaxTagPlaceholder]="tagPlaceHolder"
                  nzPlaceHolder=""
                  [nzSuffixIcon]="suffixIconSelect"
                  nzMode="multiple"
                >
                  <nz-option
                    *ngFor="let item of fParents$ | async"
                    [nzLabel]="item.name"
                    [nzValue]="item.id"
                  >
                  </nz-option>
                </nz-select>
                <ng-template #tagPlaceHolder let-selectedList>
                  и еще {{ selectedList.length }}
                </ng-template>
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
        <div class="filter-footer" [class.filter-footer-active]="isVisibleFilter">
          <div class="filter-sort">
            <app-filter-btn
              formControlName="order"
              [orderings]="[
                      {name: 'Нас.пункт', value: 'organization.location', orderingDirection: OrderingDirection.UNDEFINED },
                      {name: 'Район', value: 'organization.location.parent', orderingDirection: OrderingDirection.UNDEFINED },
                      {name: 'Организация', value: 'organization.name', orderingDirection: OrderingDirection.UNDEFINED },
                      {name: 'Численность', value: 'organization.location.population', orderingDirection: OrderingDirection.UNDEFINED }
                  ]"
            >
            </app-filter-btn>
            <div class="filter-sort-population">
              <span>от</span>
              <input nz-input formControlName="populationStart">
              <span>до</span>
              <input nz-input formControlName="populationEnd">
            </div>
          </div>
          <div class="filter-result">
            Результатов поиска: <span>{{ (features$ | async)?.count }}</span>
          </div>
          <div class="filter-search">
            <nz-input-group [nzSuffix]="suffixIconSearch">
              <input type="text" nz-input placeholder=""/>
            </nz-input-group>
            <ng-template #suffixIconSearch>
              <i nz-icon nzType="search" style="color: #ff5700"></i>
            </ng-template>
          </div>
        </div>
      </div>
      <ng-template #suffixIconSelect>
        <i nz-icon nzType="caret-down" nzTheme="outline" style="color: #ff5700"></i>
      </ng-template>
    </form>

    <div class="container-header" *ngIf="featuresTypeSelector.value">
      <div>Населенный пункт</div>
      <div>Архив {{ currentYear - 1 }}</div>
      <div>План {{ currentYear }}</div>
      <div>План {{ currentYear + 1 }}</div>
      <div>План {{ currentYear + 2 }}</div>

    </div>

    <!--    INTERNET  -->
    <div *ngIf="featuresTypeSelector.value === featureTypes.INTERNET" class="container-list">
      <div
        class="container-wrap"
        *ngFor="
          let feature of (features$ | async)?.results
            | paginate
              : {
                  itemsPerPage: itemsPerPage,
                  currentPage: pageNumber,
                  totalItems: (features$ | async)?.count
                }
        "
      >
        <div class="container-wrap-item">
          <div class="c-location-name">
            <div class="c-location-name-item1">
              {{ feature.location }} {{ feature.location.name }}
            </div>
            <div class="c-location-name-item2">{{ feature.location }}</div>
          </div>
          <div class="c-location-peoples">
            <span>{{ feature.location }}</span> чел.
          </div>
        </div>
        <div class="container-wrap-item">
          <div class="vendors-container">
            <div class="c-vendor" *ngFor="let activeFeature of feature.archiveInternetFeatures">
              <div class="c-vendor-logo">
                <img
                  [src]="activeFeature.operator.icon"
                  [alt]="activeFeature.operator.name"
                  [title]="activeFeature.operator.name"
                />
              </div>

              <div
                class="c-vendor-status-img"
                [className]="activeFeature.channel.slug"
                [title]="activeFeature.channel.name"
              ></div>
            </div>
          </div>
        </div>
        <div class="container-wrap-item">
          <div class="vendors-container">
            <div class="c-vendor" *ngFor="let activeFeature of feature.activeInternetFeatures">
              <div class="c-vendor-logo">
                <img
                  [src]="activeFeature.operator.icon"
                  [alt]="activeFeature.operator.name"
                  [title]="activeFeature.operator.name"
                />
              </div>

              <div
                class="c-vendor-status-img"
                [className]="activeFeature.channel.slug"
                [title]="activeFeature.channel.name"
              ></div>
            </div>
          </div>
        </div>
        <div class="container-wrap-item">
          <div class="l-table-row" *ngFor="let planYearFeature of feature.planYearInternetFeatures">
            <div class="c-vendor">
              <div class="c-vendor-logo">
                <img
                  [src]="planYearFeature.operator.icon"
                  [alt]="planYearFeature.operator.name"
                  [title]="planYearFeature.operator.name"
                />
              </div>
            </div>
            <div>
              :<span>{{ planYearFeature.channel.name }}</span> (<span>{{
              planYearFeature.governmentProgram
              }}</span
            >)
            </div>
          </div>
        </div>
        <div class="container-wrap-item">
          <div
            class="l-table-row"
            *ngFor="let planYearFeature of feature.planTwoYearInternetFeatures"
          >
            <div class="c-vendor">
              <div class="c-vendor-logo">
                <img
                  [src]="planYearFeature.operator.icon"
                  [alt]="planYearFeature.operator.name"
                  [title]="planYearFeature.operator.name"
                />
              </div>
            </div>
            <div>
              :<span>{{ planYearFeature.channel.name }}</span> (<span>{{
              planYearFeature.governmentProgram
              }}</span
            >)
            </div>
          </div>
        </div>


      </div>
    </div>
    <!--    INTERNET END -->

    <!--    MOBILE -->

    <div
      *ngIf="featuresTypeSelector.value === featureTypes.MOBILE && features$ | async as features"
      class="container-list"
    >
      <div
        class="container-wrap"
        *ngFor="
          let feature of features.results
            | paginate
              : {itemsPerPage: itemsPerPage, currentPage: pageNumber, totalItems: features.count}
        "
      >
        <div class="container-wrap-item">
          <div class="c-location-name">
            <div class="c-location-name-item1">
              {{ feature.location }} {{ feature.location.name }}
            </div>
            <div class="c-location-name-item2">{{ feature.location }}</div>
          </div>
          <div class="c-location-peoples">
            <span>{{ feature.location }}</span> чел.
          </div>
        </div>
        <div class="container-wrap-item">
          <div class="vendors-container">
            <div class="c-vendor" *ngFor="let archiveFeature of feature.archiveCellularFeatures">
              <div class="c-vendor-logo">
                <img
                  [src]="archiveFeature.operator.icon"
                  [alt]="archiveFeature.operator.name"
                  [title]="archiveFeature.operator.name"
                />
              </div>

              <div class="c-vendor-status-text">{{ archiveFeature.type.name }}</div>
            </div>
          </div>
        </div>
        <div class="container-wrap-item">
          <div class="vendors-container">
            <div class="c-vendor" *ngFor="let activeFeature of feature.activeCellularFeatures">
              <div class="c-vendor-logo">
                <img
                  [src]="activeFeature.operator.icon"
                  [alt]="activeFeature.operator.name"
                  [title]="activeFeature.operator.name"
                />
              </div>

              <div class="c-vendor-status-text">{{ activeFeature.type.name }}</div>
            </div>
          </div>
        </div>
        <div class="container-wrap-item">
          <div class="l-table-row" *ngFor="let planYearFeature of feature.planYearCellularFeatures">
            <div class="c-vendor">
              <div class="c-vendor-logo">
                <img
                  [src]="planYearFeature.operator.icon"
                  [alt]="planYearFeature.operator.name"
                  [title]="planYearFeature.operator.name"
                />
              </div>
            </div>
            <div>
              :<span>{{ planYearFeature.type.name }}</span> (<span>{{
              planYearFeature.governmentProgram
              }}</span
            >)
            </div>
          </div>
        </div>
        <div class="container-wrap-item">
          <div
            class="l-table-row"
            *ngFor="let planYearFeature of feature.planTwoYearCellularFeatures"
          >
            <div class="c-vendor">
              <div class="c-vendor-logo">
                <img
                  [src]="planYearFeature.operator.icon"
                  [alt]="planYearFeature.operator.name"
                  [title]="planYearFeature.operator.name"
                />
              </div>
            </div>
            <div>
              :<span>{{ planYearFeature.type.name }}</span> (<span>{{
              planYearFeature.governmentProgram
              }}</span
            >)
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--    MOBILE END -->

    <div style="display: flex; justify-content: flex-end" *ngIf="features$">
      <div class="pagination-count">
        <div style="margin-right: 13px">Количество строк на странице:</div>
        <input
          class="pagination-count-button"
          [class.active]="itemsPerPage === 10"
          type="button"
          (click)="itemsPerPage = 10"
          value="10"
        />
        <input
          class="pagination-count-button"
          [class.active]="itemsPerPage === 20"
          type="button"
          (click)="itemsPerPage = 20"
          value="20"
        />
        <input
          class="pagination-count-button"
          [class.active]="itemsPerPage === 100"
          type="button"
          (click)="itemsPerPage = 100"
          value="100"
        />
      </div>
    </div>
  </div>

  <pagination-controls
    *ngIf="this.features$"
    class="pagination-controls"
    (pageChange)="onPageChange($event)"
    previousLabel="Предыдущая страница"
    nextLabel="Следующая страница"
  >
  </pagination-controls>
</main>

<ngx-spinner
  bdOpacity="0.9"
  size="medium"
  color="#35a584"
  type="ball-atom"
  class="spinner"
  [fullScreen]="true"
>Загрузка. . .
</ngx-spinner>
